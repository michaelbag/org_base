# Структура репозиториев

## Обзор

Проект организован с разделением на репозиторий разработки и систему отслеживания изменений документов.

## Репозиторий разработки

**Назначение:** Хранение исходных кодов, тестов, конфигураций и демонстрационных материалов.

### Что включается в репозиторий:

✅ **Включается:**
- `scripts/` - весь исходный код
- `web/` - веб-интерфейс (шаблоны, CSS, JS)
- `tests/` - тестовые файлы
- `config/` - конфигурационные файлы
- `demo_documents/` - демонстрационные документы и реквизиты компаний
- `documents/` - рабочие документы (исходные версии)
- `version_history/*.json` - метаданные истории (JSON файлы)
- `.git/hooks/` - Git hooks для автоматического отслеживания
- `requirements.txt`, `README.md` и другие конфигурационные файлы

❌ **Не включается:**
- `pdf/` - сгенерированные PDF файлы
- `version_history/versions/` - сохраненные версии документов (могут быть в отдельном репозитории)
- `__pycache__/`, `*.pyc` - скомпилированные файлы Python
- `venv/`, `.venv/` - виртуальные окружения

### Структура:

```
org_base/
├── scripts/              # Исходный код
│   ├── document_parser.py
│   ├── generate_pdf.py
│   ├── server.py
│   ├── version_tracker.py
│   └── git_hooks.py
├── web/                  # Веб-интерфейс
│   ├── templates/
│   └── static/
├── tests/                # Тесты
│   ├── test_document_parser.py
│   └── test_version_tracker.py
├── config/               # Конфигурация
│   └── config.yaml
├── demo_documents/       # Демо-материалы
│   ├── company_info.yaml
│   └── ...
├── documents/            # Рабочие документы
│   └── ...
├── version_history/      # История изменений
│   ├── *.json           # Метаданные истории
│   └── versions/         # Версии документов (опционально)
└── .git/hooks/          # Git hooks
```

## Репозиторий истории изменений (опционально)

**Назначение:** Хранение всех версий документов для полной истории изменений.

### Что включается:

✅ **Включается:**
- `version_history/versions/` - все сохраненные версии документов
- `version_history/*.json` - метаданные истории изменений

### Когда использовать отдельный репозиторий:

1. **Большой объем документов** - если версии занимают много места
2. **Разделение доступа** - разные права доступа к коду и истории
3. **Резервное копирование** - отдельное хранилище для истории
4. **Производительность** - меньший размер основного репозитория

### Настройка отдельного репозитория:

```bash
# Создание отдельного репозитория для истории
cd version_history
git init
git add .
git commit -m "Initial history repository"
```

## Работа с версионированием

### Автоматическое отслеживание

При каждом коммите изменений документов Git hook автоматически:
1. Определяет измененные `.md` файлы
2. Создает запись в истории с автором из Git конфигурации
3. Сохраняет версию документа в `version_history/versions/`

### Ручное отслеживание

```python
from pathlib import Path
from scripts.version_tracker import VersionTracker

tracker = VersionTracker("documents", "version_history")

# Отслеживание изменения
change = tracker.track_change(
    Path("documents/org/dept/doc.md"),
    author="Иванов И.И.",
    comment="Обновление согласно новым требованиям"
)
```

### Просмотр истории

```python
# Получение истории документа
history = tracker.get_history(Path("documents/org/dept/doc.md"))

# Получение конкретной версии
version = tracker.get_document_version(
    Path("documents/org/dept/doc.md"),
    version=2
)
```

## Миграция на отдельный репозиторий истории

Если решено выделить историю в отдельный репозиторий:

1. Создайте новый репозиторий:
   ```bash
   mkdir org_base_history
   cd org_base_history
   git init
   ```

2. Скопируйте историю:
   ```bash
   cp -r ../org_base/version_history/* .
   ```

3. Настройте основной репозиторий:
   - Добавьте `version_history/versions/` в `.gitignore`
   - Обновите конфигурацию для работы с внешним репозиторием истории

4. Обновите скрипты для работы с внешним репозиторием (если нужно)

## Рекомендации

1. **Основной репозиторий** должен содержать только актуальные версии документов
2. **История** может быть в том же репозитории для небольших проектов
3. **Для больших проектов** лучше выделить историю в отдельный репозиторий
4. **Регулярно делайте бэкапы** обоих репозиториев
5. **Используйте Git LFS** для больших файлов истории (если нужно)

