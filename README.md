# Система ведения нормативной документации

Система для ведения внутренней нормативной документации компаний с автоматической генерацией PDF, веб-интерфейсом для навигации и системой отслеживания изменений документов.

## Структура репозиториев

Проект состоит из двух основных компонентов:

### 1. Репозиторий разработки (текущий)

Содержит исходные коды, тесты, конфигурации и демонстрационные материалы:

- `scripts/` - исходные коды приложения
  - `document_parser.py` - парсер документов
  - `generate_pdf.py` - генератор PDF
  - `server.py` - веб-сервер
  - `version_tracker.py` - система версионирования
  - `git_hooks.py` - Git hooks для автоматического отслеживания
- `web/` - веб-интерфейс (шаблоны, CSS, JavaScript)
- `tests/` - тестовые файлы
- `config/` - конфигурационные файлы
- `demo_documents/` - демонстрационные документы и реквизиты компаний
- `documents/` - исходные документы (рабочие)
- `pdf/` - сгенерированные PDF (не коммитится)
- `version_history/` - история изменений документов (может быть отдельным репозиторием)

### 2. Репозиторий истории изменений (опционально)

Может быть выделен в отдельный репозиторий для отслеживания всех версий документов:
- `version_history/` - содержит JSON файлы с историей и сохраненные версии документов

## Структура проекта

- `documents/` - исходные документы в формате Markdown
- `pdf/` - сгенерированные PDF файлы (не коммитится)
- `web/` - веб-интерфейс для просмотра
- `scripts/` - скрипты для генерации PDF и обработки документов
- `tests/` - тестовые файлы
- `config/` - конфигурационные файлы
- `demo_documents/` - демонстрационные документы и реквизиты
- `version_history/` - история изменений документов

## Формат документов

Документы хранятся в формате Markdown с YAML front matter для метаданных:

```markdown
---
type: приказ
organization: ООО "Компания"
department: Отдел кадров
number: ПР-001
date: 2024-01-15
title: О назначении ответственного лица
status: действующий
---

# Приказ ПР-001

О назначении ответственного лица...
```

## Установка

### Требования

- Python 3.8+
- wkhtmltopdf (для генерации PDF)

**Важно:** Проект использует виртуальную среду Python. Подробности см. в [VIRTUAL_ENV.md](VIRTUAL_ENV.md)

### Шаги установки

1. Создайте виртуальную среду Python (если еще не создана):
```bash
python3 -m venv venv
```

2. Активируйте виртуальную среду:

**macOS/Linux:**
```bash
source venv/bin/activate
```

**Windows:**
```bash
venv\Scripts\activate
```

3. Установите зависимости Python в виртуальную среду:
```bash
pip install -r requirements.txt
```

**Важно:** Все скрипты Python в этом проекте должны запускаться в активированной виртуальной среде!

Для удобства можно использовать скрипты-обертки:
- `./run_server.sh` или `run_server.bat` - запуск веб-сервера
- `./generate_pdf.sh` или `generate_pdf.bat` - генерация PDF

Подробнее о работе с виртуальной средой см. [VIRTUAL_ENV.md](VIRTUAL_ENV.md)

4. Установите wkhtmltopdf:

**macOS:**
```bash
brew install wkhtmltopdf
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt-get install wkhtmltopdf
```

**Windows:**
Скачайте установщик с [официального сайта](https://wkhtmltopdf.org/downloads.html)

## Использование

### Структура документов

Создавайте документы в папке `documents/` по следующей структуре:
```
documents/
  └── {организация}/
      └── {отдел}/
          └── {тип документа}/
              └── {имя_файла}.md
```

Пример:
```
documents/
  └── ООО Компания/
      └── Отдел кадров/
          └── приказы/
              └── приказ-001.md
```

### Создание документа

Каждый документ должен начинаться с YAML front matter (метаданные):

```markdown
---
type: приказ
organization: ООО "Компания"
department: Отдел кадров
number: ПР-001
date: 2024-01-15
title: О назначении ответственного лица
status: действующий
---

# Содержимое документа в Markdown
```

**Обязательные поля метаданных:**
- `type` - тип документа (приказ, распоряжение, положение и т.д.)
- `organization` - название организации
- `department` - отдел
- `title` или `number` - название или номер документа
- `date` - дата документа (формат: YYYY-MM-DD)
- `status` - статус (действующий, утративший силу, проект)

### Генерация PDF

Для генерации PDF файлов из всех документов:

**Важно:** Убедитесь, что виртуальная среда активирована!

```bash
cd /Users/kma/projects/org_base
source venv/bin/activate  # macOS/Linux
# или
venv\Scripts\activate     # Windows

python scripts/generate_pdf.py
```

PDF файлы будут сохранены в папке `pdf/` с той же структурой, что и исходные документы.

### Запуск веб-сервера

Для запуска веб-интерфейса:

**Важно:** Убедитесь, что виртуальная среда активирована!

```bash
cd /Users/kma/projects/org_base
source venv/bin/activate  # macOS/Linux
# или
venv\Scripts\activate     # Windows

python scripts/server.py
```

Откройте в браузере: **http://localhost:8000**

### Функции веб-интерфейса

- **Поиск и фильтрация** документов по:
  - Организации
  - Отделу
  - Типу документа
  - Статусу
  
- **Просмотр документов** в удобном формате с метаданными

- **Скачивание PDF** для печати (если PDF был сгенерирован)
- **Просмотр истории изменений** - кто и когда вносил изменения в документ
- **Просмотр предыдущих версий** документов

### Система версионирования

Система автоматически отслеживает все изменения в документах:

1. **Автоматическое отслеживание через Git hooks**
   - При каждом коммите изменений документов автоматически создается запись в истории
   - Автор определяется из Git конфигурации (`git config user.name`)
   - Комментарий берется из сообщения коммита

2. **Ручное отслеживание**
   ```python
   from scripts.version_tracker import VersionTracker
   
   tracker = VersionTracker("documents", "version_history")
   tracker.track_change(
       Path("documents/org/dept/doc.md"),
       author="Иванов И.И.",
       comment="Обновление регламента"
   )
   ```

3. **Просмотр истории**
   - В веб-интерфейсе на странице документа отображается история изменений
   - Можно просмотреть любую предыдущую версию документа
   - Для каждой версии сохраняется: автор, дата, комментарий, метаданные

### Настройка Git hooks

Git hooks настроены автоматически. Для ручной настройки:

```bash
chmod +x .git/hooks/pre-commit
```

Hook будет автоматически отслеживать изменения документов при каждом коммите.

### Тестирование

Запуск тестов:

```bash
python -m unittest discover tests
```

Или с pytest:

```bash
pytest tests/
```

## Типы документов

- Приказы
- Распоряжения
- Служебные записки
- Регламенты
- Положения
- Инструкции
- И другие типы документов

