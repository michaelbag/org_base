# Импорт и экспорт документов в формате DOCX

Система поддерживает загрузку и выгрузку документов в формате Microsoft Word (DOCX).

## Возможности

### Выгрузка в DOCX

Вы можете выгрузить любой документ в формате DOCX с настройкой параметров:

- **Включать метаданные** - добавлять метаданные документа в свойства файла Word
- **Включать технические данные** - добавлять таблицу с техническими данными (организация, отдел, номер, дата, статус)

### Загрузка из DOCX

При загрузке DOCX файла:

1. **Сохранение как версии** - загруженный DOCX файл автоматически сохраняется в истории версий
2. **Конвертация в Markdown** - содержимое DOCX преобразуется в формат Markdown
3. **Обновление документа** - при включенной опции "Обновить существующий документ" происходит обновление рабочего документа с сохранением важных метаданных

## Использование через веб-интерфейс

### Выгрузка

1. Откройте документ в веб-интерфейсе
2. В разделе "Работа с DOCX" настройте параметры:
   - Включать метаданные
   - Включать технические данные
3. Нажмите "Выгрузить DOCX"

### Загрузка

1. Откройте документ в веб-интерфейсе
2. В разделе "Работа с DOCX" заполните форму:
   - Выберите DOCX файл
   - Укажите автора (необязательно)
   - Добавьте комментарий (необязательно)
   - Настройте параметры импорта
   - Выберите "Обновить существующий документ" для обновления
3. Нажмите "Загрузить DOCX"

## Использование через API

### Выгрузка

```bash
GET /api/docx/export/{doc_path}?include_metadata=true&include_technical=true
```

Параметры:
- `include_metadata` - включать метаданные (true/false)
- `include_technical` - включать технические данные (true/false)

### Загрузка

```bash
POST /api/docx/import
Content-Type: multipart/form-data

file: <docx_file>
doc_path: <path_to_document>
author: <author_name>
comment: <comment>
include_metadata: true
include_technical: true
update_existing: true
```

Параметры:
- `file` - DOCX файл для загрузки
- `doc_path` - путь к документу в формате `Организация/Отдел/тип/документ.md`
- `author` - автор загрузки (необязательно)
- `comment` - комментарий к версии (необязательно)
- `include_metadata` - включать метаданные при конвертации (true/false)
- `include_technical` - включать технические данные при конвертации (true/false)
- `update_existing` - обновить существующий документ (true/false)

## Формат DOCX

### При выгрузке

- Заголовок документа (если указан в метаданных)
- Таблица с техническими данными (если включено)
- Содержимое документа в формате Markdown, преобразованное в форматирование Word:
  - Заголовки (H1-H4)
  - Таблицы
  - Списки (маркированные и нумерованные)
  - Обычный текст

### При загрузке

Система извлекает из DOCX:
- Заголовки (преобразуются в Markdown заголовки #, ##, ###, ####)
- Таблицы (преобразуются в Markdown таблицы)
- Списки (преобразуются в Markdown списки)
- Обычный текст

Метаданные из свойств документа (если включено):
- Название документа
- Автор
- Дата создания

## Версионирование

При загрузке DOCX файла:

1. Загруженный DOCX сохраняется в `version_history/versions/` с временной меткой
2. Создается запись в истории изменений документа
3. Рабочий документ обновляется (если выбрана опция обновления)

Формат имени версии: `{имя_документа}_{YYYYMMDD_HHMMSS}.docx`

## Ограничения

- Поддерживаются только файлы формата `.docx` (не `.doc`)
- Максимальный размер файла: 10 МБ (настраивается в конфигурации)
- Сложное форматирование может быть упрощено при конвертации
- Изображения и встроенные объекты не поддерживаются

## Установка зависимостей

Для работы с DOCX необходимо установить библиотеку:

```bash
pip install python-docx
```

Или через requirements.txt:

```bash
pip install -r requirements.txt
```

